<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>GCash Receipt OCR Helper</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <!-- Tesseract.js for OCR -->
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>

  <style>
    * { box-sizing: border-box; }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI";
      margin: 0; padding: 0;
      background: #f3f6fb; color: #222;
    }
    .container { max-width: 960px; margin: 1.5rem auto; padding: 1rem; }
    h1 { text-align: center; margin-bottom: 1rem; font-size: 1.5rem; }
    .card {
      background: #fff; border-radius: 10px;
      padding: 1rem 1.25rem; margin-bottom: 1rem;
      box-shadow: 0 4px 10px rgba(0,0,0,0.05);
    }
    .card h2 { margin: 0 0 .75rem; font-size: 1.2rem; }
    label { font-size: .85rem; font-weight: 600; display: block; margin-bottom: .25rem; }
    input, textarea, select {
      width: 100%; padding: .5rem .6rem; border-radius: 6px;
      border: 1px solid #ccc; font-size: .95rem;
    }
    textarea { min-height: 100px; resize: vertical; }
    .row { display: flex; flex-wrap: wrap; gap: .75rem; }
    .col-3 { flex: 0 0 calc(25% - .6rem); }
    .col-4 { flex: 0 0 calc(33.333% - .5rem); }
    .col-6 { flex: 0 0 calc(50% - .4rem); }
    .col-12 { flex: 0 0 100%; }
    .file-wrapper { display: flex; flex-direction: column; gap: .35rem; }
    .file-label {
      padding: .7rem 1.4rem; border-radius: 999px;
      background: #0066ff; color: #fff;
      cursor: pointer; font-size: .95rem; font-weight: 600;
      max-width: 260px; text-align: center;
    }
    .file-wrapper input[type="file"] { display: none; }
    button {
      border: none; border-radius: 999px;
      padding: .45rem .9rem; font-size: .9rem;
      cursor: pointer; font-weight: 600;
    }
    .btn-main { background: #0066ff; color: #fff; }
    .btn-secondary { background: #e5e9f5; color: #222; }
    .btn-small { font-size: .8rem; padding: .3rem .6rem; }
    .status { font-size: .8rem; color: #555; }
    .mono { font-family: "Courier New", monospace; }
  </style>
</head>
<body>
<div class="container">
  <h1>GCash Receipt OCR Helper</h1>

  <!-- Upload -->
  <div class="card">
    <h2>1. Upload GCash Receipt</h2>
    <div class="file-wrapper">
      <label class="file-label" for="imageInput">Choose Receipt Photo</label>
      <input type="file" id="imageInput" accept="image/*">
    </div>
    <button id="runOcrBtn" class="btn-secondary" style="margin-top:.5rem;">Run OCR Again</button>
    <div id="ocrStatus" class="status"></div>
  </div>

  <!-- Details -->
  <div class="card">
    <h2>2. Extracted Details (Editable)</h2>

    <div class="row">

      <div class="col-6">
        <label>Name</label>
        <input id="nameInput">
      </div>

      <div class="col-6">
        <label>Number</label>
        <input id="numberInput">
      </div>

      <div class="col-3">
        <label>Amount</label>
        <input id="amountInput" type="number">
      </div>

      <div class="col-3">
        <label>Transaction</label>
        <select id="txOption">
          <option value="cashin">Cash In</option>
          <option value="cashout">Cash Out</option>
        </select>
      </div>

      <div class="col-3">
        <label>Service Charge</label>
        <input id="serviceInput" type="number">
      </div>

      <div class="col-3">
        <label>Net Amount</label>
        <input id="netAmountInput" readonly>
      </div>

      <div class="col-4">
        <label>Reference No.</label>
        <input id="refInput">
      </div>

      <div class="col-4">
        <label>Date & Time</label>
        <input id="datetimeInput">
      </div>

      <div class="col-4">
        <label>Original TX Text</label>
        <input id="transactionInput">
      </div>

      <div class="col-12">
        <label>Raw OCR</label>
        <textarea id="rawText" class="mono"></textarea>
      </div>

    </div>
  </div>

  <!-- Receipt -->
  <div class="card">
    <h2>3. Receipt Text</h2>
    <button id="generateReceiptBtn" class="btn-main">Generate Receipt Text</button>
    <button id="copyReceiptBtn" class="btn-secondary">Copy</button>
    <div id="copyStatus" class="status"></div>
    <textarea id="receiptText" class="mono" style="margin-top:.5rem;"></textarea>
  </div>
</div>

<script>
// helpers
function formatMoney(n) {
  if (!n || isNaN(n)) return "";
  return "P " + Number(n).toLocaleString("en-US",{minimumFractionDigits:2});
}

function calculateServiceCharge(a) {
  if (!a || a <= 0) return 5;
  if (a > 10000) a = 10000;
  return Math.ceil(a / 250) * 5;
}

function updateTotals(auto=true){
  const a=parseFloat(amountInput.value)||0;
  let fee=parseFloat(serviceInput.value)||0;
  if(auto||!fee){
    fee=calculateServiceCharge(a);
    serviceInput.value=fee;
  }
  const net=txOption.value==="cashin"?a+fee:a-fee;
  netAmountInput.value=formatMoney(net);
}

// OCR
async function doOCR(){
  const file=imageInput.files?.[0];
  if(!file) return;

  ocrStatus.innerHTML="<strong>Running OCR...</strong>";

  const {data}=await Tesseract.recognize(file,"eng",{
    logger:m=>{if(m.status==="recognizing text") ocrStatus.textContent=`Recognizing ${Math.floor(m.progress*100)}%`; }
  });

  rawText.value=data.text.trim();
  parseText(data.text);
  ocrStatus.innerHTML="<strong>Done</strong>";
}

imageInput.addEventListener("change",doOCR);
runOcrBtn.addEventListener("click",doOCR);

// parse
function parseText(txt){
  const amt=txt.match(/([0-9,]+\.\d{2})/);
  if(amt){ amountInput.value=amt[1].replace(/,/g,""); updateTotals(true); }

  const ref=txt.match(/Ref.*?([0-9]{8,})/i);
  if(ref) refInput.value=ref[1];

  const dt=txt.match(/[A-Z][a-z]{2}\s+\d{1,2}.*?(AM|PM)/);
  if(dt) datetimeInput.value=dt[0];
}

// RECEIPT
generateReceiptBtn.addEventListener("click",()=>{
  const name=nameInput.value;
  const number=numberInput.value;
  const amount=formatMoney(amountInput.value);
  const fee=formatMoney(serviceInput.value);
  const total=netAmountInput.value;
  const ref=refInput.value;
  const tx=txOption.value==="cashin"?"Cash In":"Cash Out";

  // split date/time
  let d="", t="";
  if(datetimeInput.value.includes("M")){
    const parts=datetimeInput.value.split(" ");
    // Example: Nov 29, 2025 4:52 PM
    d = parts.slice(0,3).join(" ");      // Nov 29, 2025
    t = parts.slice(3).join(" ");         // 4:52 PM
  }

  const lines=[
    `GCASH ${tx.toUpperCase()} RECEIPT`,
    "-------------------------",
    name?`Name        : ${name}`:"",
    number?`Number      : ${number}`:"",
    amount?`Amount      : ${amount}`:"",
    fee?`Service Fee : ${fee}`:"",
    total?`Total       : ${total}`:"",
    ref?`Ref No.     : ${ref}`:"",
    d?`Date        : ${d}`:"",
    t?`Time        : ${t}`:"",
    "-------------------------"
  ].filter(Boolean);

  if(tx==="Cash Out"){
    lines.push(
      "",
      "ACKNOWLEDGEMENT:",
      "Customer received the cash in full.",
      "",
      "Signature: ____________________",
      "Date:      ____________________"
    );
  }

  receiptText.value=lines.join("\n");
});

copyReceiptBtn.addEventListener("click",async()=>{
  await navigator.clipboard.writeText(receiptText.value);
  copyStatus.textContent="Copied!";
  setTimeout(()=>copyStatus.textContent="",1200);
});
</script>
</body>
</html>
