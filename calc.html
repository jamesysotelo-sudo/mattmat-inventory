<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Amount × QTY Calculator (Dark)</title>

  <!-- Prevent iPhone Safari Zoom -->
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />

  <style>
    * { box-sizing: border-box; }

    html, body {
      -webkit-text-size-adjust: 100%;
      margin: 0;
      background: #000;
      color: #f5f5f7;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      overflow-x: hidden;
    }

    button {
      border: none;
      cursor: pointer;
      font-family: inherit;
      touch-action: manipulation;
    }

    .app {
      max-width: 480px;
      margin: 0 auto;
      padding: 12px 12px 180px;
      min-height: 100vh;
    }

    h1 {
      text-align: center;
      margin: 8px 0;
      font-size: 20px;
    }

    /* Bigger totals at the top */
    .totals {
      display: flex;
      justify-content: space-between;
      background: #111;
      padding: 18px 16px;
      border-radius: 12px;
      font-weight: 700;
      margin-bottom: 14px;
      border: 1px solid #2a2a2a;
      box-shadow: 0 2px 6px rgba(0,0,0,0.8);
    }

    .totals span {
      font-size: 26px;
    }

    .label {
      font-size: 14px;
      font-weight: 600;
      color: #a0a0a0;
      display: block;
      margin-bottom: 4px;
    }

    .btn-row {
      display: flex;
      gap: 8px;
      margin-bottom: 10px;
    }

    .btn-main {
      flex: 1;
      background: #0a84ff;
      color: #fff;
      font-size: 16px;
      padding: 12px;
      border-radius: 10px;
      font-weight: 600;
    }

    .btn-reset {
      width: 56px;
      background: #111;
      color: #fff;
      font-size: 24px;
      border-radius: 10px;
      border: 1px solid #2a2a2a;
    }

    /* TABLE */
    .table {
      background: #111;
      border-radius: 10px;
      padding: 8px;
      max-height: 60vh;
      overflow-y: auto;
      border: 1px solid #2a2a2a;
    }

    .table-header,
    .item-row {
      display: grid;
      grid-template-columns: 1.3fr 1fr 1fr;
      gap: 6px;
      align-items: center;
    }

    .table-header {
      font-weight: 600;
      color: #b0b0b0;
      border-bottom: 1px solid #2a2a2a;
      padding-bottom: 4px;
      margin-bottom: 4px;
    }

    .amount-input {
      width: 100%;
      padding: 10px;
      font-size: 18px;
      background: #151515;
      border-radius: 8px;
      border: 1px solid #333;
      text-align: right;
      color: #fff;
    }

    .amount-input::placeholder {
      color: #555;
    }

    .item-row.active .amount-input {
      background: #1f1f1f;
      border-color: #0a84ff;
      box-shadow: 0 0 0 2px rgba(10,132,255,0.4);
    }

    .qty-control {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 4px;
    }

    .qty-btn {
      width: 32px;
      height: 32px;
      background: #202020;
      color: #fff;
      border: 1px solid #333;
      border-radius: 8px;
      font-size: 18px;
    }

    .qty-display {
      width: 32px;
      padding: 4px;
      text-align: center;
      background: #151515;
      border: 1px solid #333;
      border-radius: 6px;
      color: #fff;
      font-size: 18px;
    }

    .row-total {
      text-align: right;
      font-size: 16px;
      font-weight: 600;
      color: #fff;
    }

    /* NUMBER PAD */
    .pad {
      position: fixed;
      bottom: 0; left: 50%;
      transform: translateX(-50%);
      width: 100%;
      max-width: 480px;
      background: #050505;
      padding: 12px;
      border-radius: 16px 16px 0 0;
      border-top: 1px solid #181818;
      box-shadow: 0 -4px 12px rgba(0,0,0,1);
      z-index: 9999;
    }

    .pad-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 8px;
    }

    .num-key {
      padding: 16px 0;
      background: #1c1c1e;
      color: #fff;
      border-radius: 10px;
      font-size: 22px;
      border: 1px solid #2a2a2a;
    }

    .key-secondary { background: #2c2c2e; }
    .key-danger { background: #b00020; }
    .key-main { background: #0a84ff; }

    .num-key[data-key="down"] {
      height: 120px !important;
      font-size: 32px !important;
    }

    /* MODAL */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.85);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 99999;
    }

    .modal {
      background: #111;
      padding: 16px;
      border-radius: 16px;
      width: 92%;
      max-width: 420px;
      border: 1px solid #2a2a2a;
      color: #fff;
      box-shadow: 0 8px 24px rgba(0,0,0,1);
    }

    .modal-title {
      text-align: center;
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 12px;
    }

    .modal-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .summary-box,
    input.summary-box {
      min-width: 150px;
      padding: 10px;
      border-radius: 10px;
      font-size: 22px;
      font-weight: 700;
      text-align: right;
      background: #1c1c1e;
      color: #fff;
      border: 1px solid #333;
      box-sizing: border-box;
    }

    input.summary-box {
      background: #151515;
    }

    input.summary-box:focus {
      outline: none;
      border-color: #0a84ff;
      box-shadow: 0 0 0 2px rgba(10,132,255,0.4);
    }

    .change-ok { background: #1e8e3e !important; }
    .change-bad { background: #b00020 !important; }

    .modal-buttons {
      display: flex;
      gap: 8px;
      margin-top: 16px;
    }

    .btn-done {
      flex: 1;
      background: #1e8e3e;
      color: #fff;
      padding: 12px;
      border-radius: 10px;
      font-weight: 700;
    }

    .btn-cancel {
      flex: 1;
      background: #333;
      color: #fff;
      padding: 12px;
      border-radius: 10px;
      font-weight: 700;
    }

    .cash-buttons {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 8px;
      margin-top: 10px;
    }

    .cash-buttons button {
      padding: 12px;
      border-radius: 10px;
      font-size: 16px;
      background: #1c1c1e;
      color: #fff;
      border: 1px solid #333;
    }

    .cash-buttons button[data-action="manual"] {
      background: #0a84ff;
      grid-column: span 2;
    }

    .cash-buttons button[data-action="clear"] {
      background: #b00020;
    }
  </style>
</head>

<body>

<div class="app">
  <h1>Amount × QTY Calculator</h1>

  <div class="totals">
    <div>
      <span class="label">Total Amount</span>
      <span id="totalAmount">0.00</span>
    </div>
    <div style="text-align:right;">
      <span class="label">Total QTY</span>
      <span id="totalQty">0</span>
    </div>
  </div>

  <div class="btn-row">
    <button class="btn-main" id="openSummaryBtn">DONE</button>
    <button class="btn-reset" id="resetBtn">↻</button>
  </div>

  <div class="table">
    <div class="table-header">
      <div>Amount</div>
      <div style="text-align:center;">QTY</div>
      <div style="text-align:right;">Total</div>
    </div>
    <div id="rowsContainer"></div>
  </div>
</div>

<!-- NUMBER PAD -->
<div class="pad">
  <div class="pad-grid">
    <button class="num-key" data-key="7">7</button>
    <button class="num-key" data-key="8">8</button>
    <button class="num-key" data-key="9">9</button>
    <button class="num-key key-secondary" data-key="back">⌫</button>

    <button class="num-key" data-key="4">4</button>
    <button class="num-key" data-key="5">5</button>
    <button class="num-key" data-key="6">6</button>
    <button class="num-key key-danger" data-key="allclear">AC</button>

    <button class="num-key" data-key="1">1</button>
    <button class="num-key" data-key="2">2</button>
    <button class="num-key" data-key="3">3</button>

    <button class="num-key key-main" data-key="down" style="grid-row: span 2;">↓</button>

    <button class="num-key" data-key="0">0</button>
    <button class="num-key" data-key="00">00</button>
    <button class="num-key" data-key=".">.</button>
  </div>
</div>

<!-- MODAL -->
<div class="modal-backdrop" id="modalBackdrop">
  <div class="modal">
    <div class="modal-title">Payment Summary</div>

    <div class="modal-row">
      <div>Total Amount:</div>
      <div id="modalTotalAmount" class="summary-box">0.00</div>
    </div>

    <div class="modal-row">
      <div>Cash:</div>
      <!-- readonly so keyboard is hidden until Enter Manually -->
      <input type="number" id="cashInput" class="summary-box" readonly />
    </div>

    <div class="modal-row">
      <div>Change:</div>
      <div id="changeAmount" class="summary-box">0.00</div>
    </div>

    <div class="cash-buttons">
      <button data-cash="5">5</button>
      <button data-cash="10">10</button>
      <button data-cash="20">20</button>
      <button data-cash="50">50</button>

      <button data-cash="100">100</button>
      <button data-cash="500">500</button>
      <button data-cash="1000">1000</button>
      <button data-action="clear">Clear</button>

      <button data-action="manual">Enter Manually</button>
    </div>

    <div class="modal-buttons">
      <button class="btn-done" id="modalDoneBtn">Done</button>
      <button class="btn-cancel" id="modalCancelBtn">Cancel</button>
    </div>
  </div>
</div>

<script>
let activeRowIndex = 0;

const rowsContainer = document.getElementById("rowsContainer");
const totalAmountEl = document.getElementById("totalAmount");
const totalQtyEl = document.getElementById("totalQty");

/* CREATE ROW */
function createRow(index) {
  const row = document.createElement("div");
  row.className = "item-row";
  row.dataset.index = index;
  row.dataset.childAdded = "0"; // for auto-add logic

  row.innerHTML = `
    <div>
      <input 
        type="text" 
        class="amount-input" 
        readonly 
        placeholder="0.00">
    </div>
    <div class="qty-control">
      <button class="qty-btn" data-action="minus">-</button>
      <div class="qty-display">1</div>
      <button class="qty-btn" data-action="plus">+</button>
    </div>
    <div class="row-total">0.00</div>
  `;

  const amountInput = row.querySelector(".amount-input");
  const qtyDisplay = row.querySelector(".qty-display");

  amountInput.addEventListener("click", () => setActiveRow(index));

  row.querySelectorAll(".qty-btn").forEach(btn => {
    btn.onclick = () => {
      let qty = parseInt(qtyDisplay.textContent) || 0;
      qty = btn.dataset.action === "minus" ? qty - 1 : qty + 1;
      qty = Math.max(0, qty);
      qtyDisplay.textContent = qty;
      updateRowTotal(index);
      calculateTotals();
    };
  });

  return row;
}

function addRow() {
  const row = createRow(rowsContainer.children.length);
  rowsContainer.appendChild(row);
}

function setActiveRow(index) {
  activeRowIndex = index;
  document.querySelectorAll(".item-row").forEach(r => r.classList.remove("active"));
  const activeRow = document.querySelector(`.item-row[data-index="${index}"]`);
  if (activeRow) activeRow.classList.add("active");
}

function getRow(index) {
  return document.querySelector(`.item-row[data-index="${index}"]`);
}

function updateRowTotal(index) {
  const row = getRow(index);
  if (!row) return;
  const amt = parseFloat(row.querySelector(".amount-input").value) || 0;
  const qty = parseInt(row.querySelector(".qty-display").textContent) || 0;
  const total = amt * qty;
  row.querySelector(".row-total").textContent = total.toFixed(2);
}

function calculateTotals() {
  let totalAmount = 0;
  let totalQty = 0;

  document.querySelectorAll(".item-row").forEach(row => {
    const amt = parseFloat(row.querySelector(".amount-input").value) || 0;
    const qty = parseInt(row.querySelector(".qty-display").textContent) || 0;
    totalAmount += amt * qty;
    totalQty += qty;
  });

  totalAmountEl.textContent = totalAmount.toFixed(2);
  totalQtyEl.textContent = totalQty;
}

/* AUTO-ADD ROW WHEN LAST AMOUNT IS FILLED */
function autoAddRowIfLastAndFilled(index) {
  const row = getRow(index);
  if (!row) return;

  const isLast = index === rowsContainer.children.length - 1;
  if (!isLast) return;

  if (row.dataset.childAdded === "1") return;

  const val = row.querySelector(".amount-input").value || "";
  if (val === "") return;

  addRow();
  row.dataset.childAdded = "1";
}

/* NUMBER PAD HANDLING */
function handlePadInput(key) {
  const row = getRow(activeRowIndex);
  if (!row) return;

  const input = row.querySelector(".amount-input");
  let value = input.value || "";

  if (key === "back") {
    value = value.slice(0, -1);
  } else if (key === "allclear") {
    resetAll();
    return;
  } else if (key === "down") {
    // Move to next row, add if needed
    if (activeRowIndex >= rowsContainer.children.length - 1) {
      addRow();
    }
    setActiveRow(activeRowIndex + 1);
    return;
  } else if (key === ".") {
    if (!value.includes(".")) value += ".";
  } else if (key === "00") {
    if (value !== "") value += "00";
  } else {
    value += key;
  }

  input.value = value;
  updateRowTotal(activeRowIndex);
  calculateTotals();
  autoAddRowIfLastAndFilled(activeRowIndex);
}

document.querySelectorAll(".num-key").forEach(btn => {
  btn.onclick = () => handlePadInput(btn.dataset.key);
});

/* PAYMENT SUMMARY */
const modal = document.getElementById("modalBackdrop");
const cashInput = document.getElementById("cashInput");
const changeAmount = document.getElementById("changeAmount");

function setChangeState() {
  const total = parseFloat(totalAmountEl.textContent) || 0;
  const cash = parseFloat(cashInput.value) || 0;
  const diff = cash - total;

  changeAmount.textContent = diff.toFixed(2);
  changeAmount.classList.remove("change-ok", "change-bad");

  if (!total && !cash) return;
  if (cash < total) changeAmount.classList.add("change-bad");
  else changeAmount.classList.add("change-ok");
}

document.getElementById("openSummaryBtn").onclick = () => {
  document.getElementById("modalTotalAmount").textContent = totalAmountEl.textContent;
  cashInput.readOnly = true;
  modal.style.display = "flex";
};

document.getElementById("modalCancelBtn").onclick = () => {
  modal.style.display = "none";
};

document.getElementById("modalDoneBtn").onclick = () => {
  resetAll();
  modal.style.display = "none";
};

cashInput.oninput = setChangeState;

/* Cash quick buttons */
document.querySelectorAll(".cash-buttons button").forEach(btn => {
  btn.onclick = () => {
    const add = parseFloat(btn.dataset.cash || "0");
    const action = btn.dataset.action || "";

    if (add) {
      let current = parseFloat(cashInput.value || 0);
      current += add;
      cashInput.value = current.toFixed(2);
      setChangeState();
    } else if (action === "clear") {
      cashInput.value = "";
      changeAmount.textContent = "0.00";
      changeAmount.classList.remove("change-ok","change-bad");
    } else if (action === "manual") {
      cashInput.readOnly = false;
      cashInput.focus();
      cashInput.select && cashInput.select();
    }
  };
});

/* RESET */
function resetAll() {
  rowsContainer.innerHTML = "";
  addRow();
  setActiveRow(0);
  calculateTotals();
  cashInput.value = "";
  changeAmount.textContent = "0.00";
  changeAmount.classList.remove("change-ok","change-bad");
  cashInput.readOnly = true;
}

document.getElementById("resetBtn").onclick = resetAll;

/* INIT */
resetAll();
</script>

</body>
</html>
